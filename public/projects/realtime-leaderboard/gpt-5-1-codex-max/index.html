<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Realtime Leaderboard</title>
  <style>
    :root { --bg:#0b1220; --panel:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22d3ee; --border:#1f2937; }
    *{box-sizing:border-box;} body{margin:0;font-family:"Inter",sans-serif;background:var(--bg);color:var(--text);padding:16px;}
    header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px;}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;} button{background:var(--accent);color:#0b1220;border:none;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer;} button.secondary{background:var(--panel);color:var(--text);border:1px solid var(--border);} input[type="range"]{width:140px;}
    table{width:100%;border-collapse:collapse;} th,td{padding:8px;border-bottom:1px solid var(--border);text-align:left;} th{color:var(--muted);font-weight:600;} tr:hover{background:#0f172a;}
    .spark{width:120px;height:30px;} .delta{color:#22c55e;} .delta.down{color:#f87171;}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;}
  </style>
</head>
<body>
  <header>
    <div>
      <h1 style="margin:0">Real-Time Leaderboard</h1>
      <div style="color:var(--muted)">Seedable simulated event stream</div>
    </div>
    <div class="controls">
      <label style="color:var(--muted)">Event rate <span id="rateLabel">800ms</span></label>
      <input id="rate" type="range" min="200" max="2000" step="100" value="800" />
      <button id="start">Start</button>
      <button id="pause" class="secondary">Pause</button>
      <button id="reset" class="secondary">Reset</button>
      <button id="spike">Inject Spike</button>
      <input id="seed" value="1234" style="width:80px" />
    </div>
  </header>

  <section class="card">
    <table>
      <thead>
        <tr><th>#</th><th>Player</th><th>Score</th><th>Δ</th><th>Last Event</th><th>Sparkline</th></tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </section>

  <script>
    const rowsEl = document.getElementById('rows');
    const rateInput = document.getElementById('rate');
    const rateLabel = document.getElementById('rateLabel');
    const seedInput = document.getElementById('seed');
    let timer = null; let players = []; let lastRanks = new Map();

    function rng(seed) {
      let s = seed % 2147483647;
      if (s <= 0) s += 2147483646;
      return () => (s = (s * 16807) % 2147483647) / 2147483647;
    }
    let rand = rng(1234);

    function createPlayers() {
      players = Array.from({ length: 20 }, (_, i) => ({
        id: i + 1,
        name: `Player ${i + 1}`,
        score: 0,
        lastEvent: '-'
      , history: Array(20).fill(0)
      }));
    }

    function updateRateLabel() { rateLabel.textContent = `${rateInput.value}ms`; }

    function tick(amount = 1) {
      for (let i = 0; i < amount; i++) {
        const idx = Math.floor(rand() * players.length);
        const delta = Math.floor(rand() * 8) + 1;
        const player = players[idx];
        player.score += delta;
        player.lastEvent = new Date().toLocaleTimeString();
        player.history.push(player.score);
        if (player.history.length > 40) player.history.shift();
      }
      render();
    }

    function renderSparkline(history) {
      const min = Math.min(...history);
      const max = Math.max(...history);
      const range = Math.max(1, max - min);
      const points = history.map((v, i) => {
        const x = (i / (history.length - 1)) * 120;
        const y = 30 - ((v - min) / range) * 30;
        return `${x.toFixed(1)},${y.toFixed(1)}`;
      }).join(' ');
      return `<svg class="spark" viewBox="0 0 120 30"><polyline points="${points}" fill="none" stroke="${max === min ? '#4ade80' : '#22d3ee'}" stroke-width="2" stroke-linejoin="round" /></svg>`;
    }

    function render() {
      players.sort((a,b) => b.score - a.score);
      rowsEl.innerHTML = '';
      players.forEach((p, idx) => {
        const tr = document.createElement('tr');
        const prev = lastRanks.get(p.id) ?? idx;
        const delta = prev - idx;
        lastRanks.set(p.id, idx);
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${p.name}</td>
          <td>${p.score}</td>
          <td class="delta ${delta < 0 ? 'down' : ''}">${delta === 0 ? '–' : (delta > 0 ? '▲' : '▼')} ${delta === 0 ? '' : Math.abs(delta)}</td>
          <td>${p.lastEvent}</td>
          <td>${renderSparkline(p.history)}</td>
        `;
        rowsEl.appendChild(tr);
      });
    }

    function start() { if (timer) return; timer = setInterval(tick, rateInput.value); }
    function pause() { clearInterval(timer); timer = null; }
    function reset() { pause(); rand = rng(parseInt(seedInput.value,10)||1); createPlayers(); lastRanks.clear(); render(); }
    document.getElementById('start').onclick = () => { start(); };
    document.getElementById('pause').onclick = () => pause();
    document.getElementById('reset').onclick = () => reset();
    document.getElementById('spike').onclick = () => tick(8);
    rateInput.oninput = () => { updateRateLabel(); if (timer){ pause(); start(); } };
    seedInput.onchange = () => reset();

    updateRateLabel();
    reset();
  </script>
</body>
</html>
