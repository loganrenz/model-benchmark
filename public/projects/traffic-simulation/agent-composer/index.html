<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Simulation - Composer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        #canvas {
            display: block;
            background: #0f3460;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        
        // Set canvas size
        function resizeCanvas() {
            canvas.width = Math.min(1200, window.innerWidth);
            canvas.height = Math.min(800, window.innerHeight);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Constants
        const ROAD_Y = canvas.height / 2;
        const ROAD_WIDTH = 300;
        const LANE_WIDTH = ROAD_WIDTH / 2;
        const CAR_WIDTH = 40;
        const CAR_HEIGHT = 20;
        const TRAFFIC_LIGHT_X = canvas.width * 0.6;
        const TRAFFIC_LIGHT_Y = ROAD_Y - ROAD_WIDTH / 2 - 60;
        const TRAFFIC_LIGHT_SIZE = 30;
        
        // Traffic light state
        let lightState = 'green'; // 'red' or 'green'
        let lightTimer = 0;
        const GREEN_DURATION = 4000; // 4 seconds
        const RED_DURATION = 3000;   // 3 seconds
        
        // Car class
        class Car {
            constructor(x, y, color, speed) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.speed = speed;
                this.stopped = false;
            }
            
            update() {
                // Check if car should stop at traffic light
                const distanceToLight = TRAFFIC_LIGHT_X - this.x;
                const stopDistance = CAR_WIDTH + 20;
                
                if (lightState === 'red' && distanceToLight < stopDistance && distanceToLight > -CAR_WIDTH) {
                    this.stopped = true;
                    this.x = TRAFFIC_LIGHT_X - stopDistance;
                } else {
                    this.stopped = false;
                    this.x += this.speed;
                }
                
                // Reset car position when it goes off screen
                if (this.x > canvas.width + CAR_WIDTH) {
                    this.x = -CAR_WIDTH - Math.random() * 200;
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                // Car body
                ctx.fillStyle = this.color;
                ctx.fillRect(-CAR_WIDTH / 2, -CAR_HEIGHT / 2, CAR_WIDTH, CAR_HEIGHT);
                
                // Car windows
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(-CAR_WIDTH / 2 + 5, -CAR_HEIGHT / 2 + 3, 12, 8);
                ctx.fillRect(CAR_WIDTH / 2 - 17, -CAR_HEIGHT / 2 + 3, 12, 8);
                
                // Car wheels
                ctx.fillStyle = '#333';
                ctx.beginPath();
                ctx.arc(-CAR_WIDTH / 2 + 8, CAR_HEIGHT / 2, 4, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(CAR_WIDTH / 2 - 8, CAR_HEIGHT / 2, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }
        
        // Initialize cars
        const cars = [];
        const carColors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#F38181', '#AA96DA'];
        
        // Create cars at different positions
        for (let i = 0; i < 6; i++) {
            const lane = i % 2;
            const y = ROAD_Y - ROAD_WIDTH / 2 + LANE_WIDTH / 2 + lane * LANE_WIDTH;
            const x = -CAR_WIDTH - Math.random() * 500 - i * 150;
            const color = carColors[i % carColors.length];
            const speed = 1.5 + Math.random() * 0.5;
            cars.push(new Car(x, y, color, speed));
        }
        
        // Draw road
        function drawRoad() {
            // Road surface
            ctx.fillStyle = '#2d2d2d';
            ctx.fillRect(0, ROAD_Y - ROAD_WIDTH / 2, canvas.width, ROAD_WIDTH);
            
            // Lane divider
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 2;
            ctx.setLineDash([20, 20]);
            ctx.beginPath();
            ctx.moveTo(0, ROAD_Y);
            ctx.lineTo(canvas.width, ROAD_Y);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Road edges
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, ROAD_Y - ROAD_WIDTH / 2);
            ctx.lineTo(canvas.width, ROAD_Y - ROAD_WIDTH / 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, ROAD_Y + ROAD_WIDTH / 2);
            ctx.lineTo(canvas.width, ROAD_Y + ROAD_WIDTH / 2);
            ctx.stroke();
        }
        
        // Draw traffic light
        function drawTrafficLight() {
            // Traffic light pole
            ctx.fillStyle = '#555';
            ctx.fillRect(TRAFFIC_LIGHT_X - 5, TRAFFIC_LIGHT_Y + TRAFFIC_LIGHT_SIZE, 10, 40);
            
            // Traffic light box
            ctx.fillStyle = '#333';
            ctx.fillRect(
                TRAFFIC_LIGHT_X - TRAFFIC_LIGHT_SIZE / 2,
                TRAFFIC_LIGHT_Y,
                TRAFFIC_LIGHT_SIZE,
                TRAFFIC_LIGHT_SIZE * 2
            );
            
            // Red light
            ctx.fillStyle = lightState === 'red' ? '#FF0000' : '#330000';
            ctx.beginPath();
            ctx.arc(
                TRAFFIC_LIGHT_X,
                TRAFFIC_LIGHT_Y + TRAFFIC_LIGHT_SIZE / 2,
                TRAFFIC_LIGHT_SIZE / 3,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            // Green light
            ctx.fillStyle = lightState === 'green' ? '#00FF00' : '#003300';
            ctx.beginPath();
            ctx.arc(
                TRAFFIC_LIGHT_X,
                TRAFFIC_LIGHT_Y + TRAFFIC_LIGHT_SIZE * 1.5,
                TRAFFIC_LIGHT_SIZE / 3,
                0,
                Math.PI * 2
            );
            ctx.fill();
            
            // Light glow effect
            if (lightState === 'red') {
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#FF0000';
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.arc(
                    TRAFFIC_LIGHT_X,
                    TRAFFIC_LIGHT_Y + TRAFFIC_LIGHT_SIZE / 2,
                    TRAFFIC_LIGHT_SIZE / 3,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
                ctx.shadowBlur = 0;
            } else {
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#00FF00';
                ctx.fillStyle = '#00FF00';
                ctx.beginPath();
                ctx.arc(
                    TRAFFIC_LIGHT_X,
                    TRAFFIC_LIGHT_Y + TRAFFIC_LIGHT_SIZE * 1.5,
                    TRAFFIC_LIGHT_SIZE / 3,
                    0,
                    Math.PI * 2
                );
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }
        
        // Animation loop
        let lastTime = 0;
        function animate(currentTime) {
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;
            
            // Update traffic light
            lightTimer += deltaTime;
            if (lightState === 'green' && lightTimer >= GREEN_DURATION) {
                lightState = 'red';
                lightTimer = 0;
            } else if (lightState === 'red' && lightTimer >= RED_DURATION) {
                lightState = 'green';
                lightTimer = 0;
            }
            
            // Clear canvas
            ctx.fillStyle = '#0f3460';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw road
            drawRoad();
            
            // Update and draw cars
            cars.forEach(car => {
                car.update();
                car.draw();
            });
            
            // Draw traffic light
            drawTrafficLight();
            
            requestAnimationFrame(animate);
        }
        
        // Start animation
        animate(0);
    </script>
</body>
</html>
